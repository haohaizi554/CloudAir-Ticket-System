<!-- pages/order-list/index.wxml -->
<view class="container">
  
  <block wx:if="{{orderList.length > 0}}">
    <view class="order-card" wx:for="{{orderList}}" wx:key="_id">
      
      <!-- å¤´éƒ¨ï¼šè®¢å•å·ä¸çŠ¶æ€ -->
      <view class="card-header">
        <view class="user-info-small">
          <!-- ä¼˜å…ˆæ˜¾ç¤ºå½“å‰ç¼“å­˜çš„å¤´åƒï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¾ç¤ºè®¢å•å¿«ç…§çš„å¤´åƒ -->
          <image 
            class="small-avatar" 
            src="{{currentUser.avatarUrl || item.passenger_avatar}}" 
            mode="aspectFill"
          ></image>
          <text class="passenger-name">
            {{currentUser.nickName || item.passenger_name}}
          </text>
        </view>
        
        <text class="status-tag {{item.status == 1 ? 'paid' : 'refunded'}}">
          {{item.status == 1 ? 'å·²æ”¯ä»˜' : 'å·²é€€ç¥¨'}}
        </text>
      </view>

      <!-- å†…å®¹ï¼šèˆªç­ä¿¡æ¯ -->
      <view class="card-body">
        <view class="flight-row">
          <text class="city">{{item.flight_info.origin}}</text>
          <text class="arrow">--------âœˆï¸--------</text>
          <text class="city">{{item.flight_info.dest}}</text>
        </view>
        <view class="info-row">
          <text>èˆªç­: {{item.flight_info.flight_no}}</text>
          <text>æ—¥æœŸ: {{item.flight_info.dept_time}}</text>
        </view>
        <view class="seat-info">
          åº§ä½å·ï¼š<text class="seat-no">{{item.seat_no}}</text>
        </view>
      </view>

      <!-- åº•éƒ¨ï¼šæ“ä½œæ  -->
      <view class="card-footer">
        <text class="price">Â¥{{item.price}}</text>
        
        <view class="btn-group">
          <!-- å‡ºç¤ºç™»æœºç æŒ‰é’® (ä»…å·²æ”¯ä»˜çŠ¶æ€æ˜¾ç¤º) -->
          <button 
            wx:if="{{item.status == 1}}" 
            class="btn-code" 
            size="mini" 
            bindtap="onShowCode" 
            data-order="{{item}}"
          >
            å‡ºç¤ºç™»æœºç 
          </button>

          <!-- é€€ç¥¨æŒ‰é’® (ä»…å·²æ”¯ä»˜çŠ¶æ€æ˜¾ç¤º) -->
          <button 
            wx:if="{{item.status == 1}}" 
            class="btn-refund" 
            size="mini" 
            bindtap="onRefund" 
            data-order="{{item}}"
          >
            ç”³è¯·é€€ç¥¨
          </button>
        </view> 
      </view> 
    </view> 
  </block>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-state">
    <text>ğŸ“­ æ‚¨è¿˜æ²¡æœ‰è®¢å•</text>
  </view>
</view>